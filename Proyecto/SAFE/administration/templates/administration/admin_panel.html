{% extends 'base.html' %}
{% load static %}

{% block title %}
  Administración — SAFE
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'administration/css/admin_panel.css' %}" />
{% endblock %}

{% block content %}
  <div class="admin-container">
    <h1 class="admin-title">Administración</h1>

    <div class="admin-tabs">
      <a href="?tab=usuarios" class="admin-tab {% if active_tab == 'usuarios' %}active{% endif %}">Usuarios</a>
      <a href="?tab=cursos" class="admin-tab {% if active_tab == 'cursos' %}active{% endif %}">Cursos</a>
      <a href="?tab=rutas" class="admin-tab {% if active_tab == 'rutas' %}active{% endif %}">Rutas</a>
      <a href="?tab=estadisticas" class="admin-tab {% if active_tab == 'estadisticas' %}active{% endif %}">Estadísticas</a>
    </div>

    <!-- USUARIOS -->
    {% if active_tab == 'usuarios' %}
  
  <div class="card-panel">
    
    <div class="panel-header">
      <h2 class="panel-title">Gestión de usuarios</h2>
      <a href="{% url 'user_add' %}" class="btn btn-gold">Nuevo usuario</a>
    </div>

    <div class="table-responsive">
      <table class="table-custom">
        <thead>
          <tr>
            <th class="th-name">Nombre</th>
            <th class="th-email">Email</th>
            <th class="th-role">Rol</th>
            <th class="th-status">Estado</th>
            <th class="th-actions text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for u in usuarios %}
            <tr>
              <td class="font-weight-medium">{{ u.name|default:u.username }}</td>
              
              <td class="text-muted">{{ u.email }}</td>
              
              <td>
                <form method="post" action="{% url 'user_update_role' u.id %}">
                  {% csrf_token %}
                  
                  <select name="role" class="role-select" onchange="this.form.submit()">
                    
                    <option value="colaborador" {% if u.role == 'colaborador' %}selected{% endif %}>
                      Colaborador
                    </option>
                    
                    <option value="supervisor" {% if u.role == 'supervisor' %}selected{% endif %}>
                      Supervisor
                    </option>
                    
                    <option value="analistaTH" {% if u.role == 'analistaTH' %}selected{% endif %}>
                      Analista TH
                    </option>
                    
                  </select>
                </form>
              </td>
              
              <td>
                <span class="status-badge status-{{ u.status }}">
                  {{ u.get_status_display }}
                </span>
              </td>
              
              <td class="text-right">
                <div class="actions-group">
                  
                  <form method="post" action="{% url 'user_toggle_status' u.id %}" style="display:inline;">
                    {% csrf_token %}
                    
                    {% if u.status == 'active' %}
                      <button type="submit" class="action-link text-danger" title="Desactivar usuario">
                        Desactivar
                      </button>
                    
                    {% else %}
                      <button type="submit" class="action-link text-success" title="Activar usuario">
                        Activar
                      </button>
                    {% endif %}
                    
                  </form>

                  <a href="#" class="action-link text-primary">Inscribir a curso</a>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5" class="empty-state">No hay usuarios registrados.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endif %}

    <!-- CURSOS -->
    {% if active_tab == 'cursos' %}
      <div class="section-header">
        <h2>Cursos disponibles</h2>
        <a href="{% url 'course_create' %}" class="btn-primary">Nuevo</a>
      </div>

      {% if courses %}
        <div class="courses-grid">
          {% for course in courses %}
            <div class="course-card">
              <div class="course-header">
                <!-- Aca poner el renderizado de la imagen -->
              </div>
              <div class="course-body">
                <div class="course-title-row">
                  <h3>{{ course.name }}</h3>
                  <span class="badge badge-{{ course.status }}">{{ course.get_status_display }}</span>
                </div>
                <p class="course-description">{{ course.description|default:'Sin descripción' }}</p>
                <div class="course-meta">
                  <span>{{ course.duration_hours|default:'--' }}h</span>
                  <span>{{ course.modules.count }} módulos</span>
                </div>
                <div class="course-actions">
                  <a href="{% url 'course_detail' course.pk %}" class="btn-secondary">Ver</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state">
          <p>No hay cursos creados</p>
          <a href="{% url 'course_create' %}" class="btn-primary">Crear primer curso</a>
        </div>
      {% endif %}
    {% endif %}

    <!-- RUTAS -->
    {% if active_tab == 'rutas' %}
      <div class="section-header">
        <h2>Rutas de aprendizaje</h2>
        <a class="btn-nuevo">Nueva ruta</a>
      </div>

      {% if rutas %}

      {% else %}
        <div class="empty-state">
          <p>No hay rutas creadas</p>
          <a class="btn-primary">Crear primer ruta</a>
        </div>
      {% endif %}
    {% endif %}

    <!-- ESTADÍSTICAS -->
    {% if active_tab == 'estadisticas' %}
      <div class="section-header">
        <h2>Estadísticas y KPIs</h2>
      </div>
      <div>
        <div class="empty-state">Gráficos y estadísticas aquí</div>
      </div>
    {% endif %}
  </div>
{% endblock %}
