{% extends 'base.html' %}
{% load static %}

{% block title %}
  Crear Examen ‚Äî SAFE
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'accounts/css/login.css' %}" />
  <link rel="stylesheet" href="{% static 'courses/css/create_exam.css' %}" />
{% endblock %}

{% block content %}
<div class="shell">
  <div class="card">
    <header class="top">
      <img class="logo" src="{% static 'img/safe_logo.jpeg' %}" alt="SAFE" />
      <div>
        <p class="subtitle">Sistema Acad√©mico de Formaci√≥n Empresarial</p>
        <h1 class="title">Crear Examen</h1>
      </div>
    </header>

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="form-panel">
        
        <label for="{{ form.course.id_for_label }}" class="label">Seleccionar curso</label>
        {{ form.course }}
        {% if form.course.errors %}
          <div class="alert-warning">{{ form.course.errors }}</div>
        {% endif %}

        <label for="{{ form.difficulty.id_for_label }}" class="label mt">Nivel de dificultad</label>
        {{ form.difficulty }}
        {% if form.difficulty.errors %}
          <div class="alert-warning">{{ form.difficulty.errors }}</div>
        {% endif %}

        <label class="label mt">Subir archivo</label>
        
        {{ form.file }}

        <label for="real-file-input" class="drop-zone" id="drop-zone-container">
          <div class="drop-zone-icon">üìÅ</div>
          <span class="drop-zone-text" id="drop-zone-text">
            Arrastra un archivo o haz clic para seleccionar
          </span>
          <button type="button" class="btn-select-file" id="fake-file-button">
            Seleccionar archivo
          </button>
        </label>
        {% if form.file.errors %}
          <div class="alert-warning" style="color:red; margin-top: 8px;">
            {{ form.file.errors }}
          </div>
        {% endif %}

        <div class="form-actions">
          <button type="button" class="btn-secondary">Cancelar</button>
          <button type="submit" class="btn btn-gold">Crear examen</button>
        </div>

      </div>
    </form>
  </div>
</div>

<script>
  // Obtenemos los elementos
  const realFileInput = document.getElementById('real-file-input');
  const fakeFileButton = document.getElementById('fake-file-button');
  const dropZoneText = document.getElementById('drop-zone-text');

  // 1. Conectar el bot√≥n falso al input real
  fakeFileButton.addEventListener('click', (e) => {
    e.preventDefault(); // Evita que el <label> se active dos veces
    realFileInput.click();
  });

  // 2. Mostrar el nombre del archivo cuando se selecciona
  realFileInput.addEventListener('change', () => {
    if (realFileInput.files.length > 0) {
      // Muestra el nombre del archivo como en tu mockup
      dropZoneText.textContent = 'Archivo seleccionado: ' + realFileInput.files[0].name;
    }
  });

  // 3. (Opcional) Manejo de Arrastrar y Soltar (Drag and Drop)
  const dropZoneContainer = document.getElementById('drop-zone-container');
  
  dropZoneContainer.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZoneContainer.style.background = '#f4f4f5'; // Feedback visual
  });

  dropZoneContainer.addEventListener('dragleave', () => {
    dropZoneContainer.style.background = '#fafafa';
  });

  dropZoneContainer.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZoneContainer.style.background = '#fafafa';
    
    // Asigna los archivos soltados al input real
    realFileInput.files = e.dataTransfer.files;

    // Dispara el evento 'change' manualmente
    realFileInput.dispatchEvent(new Event('change'));
  });

</script>
{% endblock %}